# VibeMon ESP32 Firmware

Прошивка для ESP32 с датчиками температуры (DS18B20) и вибрации (MPU6050).
Передаёт данные по Bluetooth Low Energy (BLE) в веб-приложение VibeMon.

## Требования

### Аппаратное обеспечение
- ESP32 DevKit v1 (или совместимая плата)
- DS18B20 - датчик температуры (опционально)
- MPU6050 - акселерометр/гироскоп (опционально)

Если датчики не подключены, будут генерироваться тестовые данные.

### Подключение

```
ESP32          DS18B20
------         -------
GPIO 4    <->  DATA
3.3V      <->  VCC
GND       <->  GND
+ резистор 4.7kΩ между DATA и VCC

ESP32          MPU6050
------         -------
GPIO 21   <->  SDA
GPIO 22   <->  SCL
3.3V      <->  VCC
GND       <->  GND
```

### Схема подключения

```
                    +3.3V
                      │
                      ├────────────────┐
                      │                │
                    [4.7kΩ]            │
                      │                │
ESP32 GPIO4 ─────────┼──── DS18B20 DATA
                      │
                     GND


ESP32 GPIO21 (SDA) ───────── MPU6050 SDA
ESP32 GPIO22 (SCL) ───────── MPU6050 SCL
ESP32 3.3V ───────────────── MPU6050 VCC
ESP32 GND ────────────────── MPU6050 GND
```

## Установка

### 1. Установите Arduino IDE
Скачайте с https://www.arduino.cc/en/software

### 2. Добавьте поддержку ESP32
1. Откройте Arduino IDE
2. Файл → Настройки
3. В поле "Дополнительные ссылки для Менеджера плат" добавьте:
   ```
   https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
   ```
4. Инструменты → Плата → Менеджер плат
5. Найдите "ESP32" и установите "ESP32 by Espressif Systems"

### 3. Установите библиотеки
Скетч → Подключить библиотеку → Управление библиотеками

Установите:
- **OneWire** by Jim Studt
- **DallasTemperature** by Miles Burton
- **Adafruit MPU6050** by Adafruit
- **Adafruit Unified Sensor** by Adafruit

### 4. Загрузите прошивку
1. Подключите ESP32 к компьютеру по USB
2. Выберите плату: Инструменты → Плата → ESP32 Dev Module
3. Выберите порт: Инструменты → Порт → COM... (ваш порт)
4. Нажмите "Загрузка" (→)

## Использование

### Индикация светодиода
- **Мигает** - ожидание подключения BLE
- **Горит постоянно** - клиент подключен
- **3 быстрых мигания** - устройство запустилось

### Serial Monitor
Откройте Serial Monitor (115200 бод) для отладки:
```
=============================
   VibeMon ESP32 v1.0
=============================

Инициализация DS18B20... OK
Инициализация MPU6050... OK
Инициализация BLE... OK

-----------------------------
Устройство готово к работе!
Имя BLE: VibeMon-001
-----------------------------

Температура: 45.3°C | Вибрация: 1.24g [Ожидание подключения...]
Температура: 45.5°C | Вибрация: 1.18g [BLE ✓]
```

## BLE Характеристики

| UUID | Описание | Формат |
|------|----------|--------|
| `12345678-1234-5678-1234-56789abcdef0` | Service UUID | - |
| `12345678-1234-5678-1234-56789abcdef1` | Температура | float32, little-endian |
| `12345678-1234-5678-1234-56789abcdef2` | Вибрация | float32, little-endian |

## Настройка

В файле `vibemon_esp32.ino` можно изменить:

```cpp
#define DEVICE_NAME "VibeMon-001"    // Имя устройства BLE
#define ONE_WIRE_BUS 4               // Пин DS18B20
#define I2C_SDA 21                   // Пин SDA для MPU6050
#define I2C_SCL 22                   // Пин SCL для MPU6050
#define UPDATE_INTERVAL 1000         // Интервал обновления (мс)
```

## Устранение неполадок

### ESP32 не определяется
- Установите драйвер CP210x или CH340 (зависит от платы)
- Попробуйте другой USB кабель (некоторые только для зарядки)

### Датчик температуры не найден
- Проверьте подключение и резистор 4.7kΩ
- Попробуйте другой пин (измените ONE_WIRE_BUS)

### MPU6050 не найден
- Проверьте подключение I2C (SDA, SCL)
- Убедитесь что адрес 0x68 (по умолчанию)

### BLE не подключается
- Убедитесь что используете Chrome или Edge
- Проверьте что Bluetooth включён на компьютере
- Перезапустите ESP32

## Лицензия

MIT License - свободное использование
